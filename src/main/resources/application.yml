########################################
# Application
########################################
spring:
  application:
    name: prodwebapp

  # Redisson 스타터 자동 설정 비활성화 (Spring Boot 4와 호환되지 않음, RedissonConfig에서 수동 빈 등록)
  autoconfigure:
    exclude:
      - org.redisson.spring.starter.RedissonAutoConfigurationV2

  # 콘솔에 ANSI 컬러 항상 사용
  output:
    ansi:
      enabled: always

  ########################################
  # Encoding
  ########################################
  servlet:
    encoding:
      charset: UTF-8
      enabled: true
      force: true

  ########################################
  # SQL Init
  # - 기본값: embedded (H2 등 임베디드 DB에서만 실행)
  # - dev: always (application-dev.yml에서 오버라이드)
  # - prod: never (운영에서는 SQL 초기화 안 함)
  ########################################
  sql:
    init:
      mode: embedded                        # 임베디드 DB(H2)에서만 SQL 초기화 실행
      continue-on-error: false              # 초기화 에러 시 중단

  ########################################
  # Redis
  ########################################
  data:
    redis:
      host: localhost
      port: 6379
      timeout: 2000ms
      connect-timeout: 5000ms

  ########################################
  # Error Handling
  ########################################
  web:
    error:
      include-message: always
      include-binding-errors: always
      include-stacktrace: on_param

  ########################################
  # Profile
  ########################################
  profiles:
    active: dev                             # 기본 프로파일: dev (개발 환경)

########################################
# Server
########################################
server:
  port: 8080

########################################
# Logging
########################################
logging:
  level:
    root: INFO
    "[com.cinema]": DEBUG
    "[org.springframework]": INFO
    "[org.springframework.web]": DEBUG
    "[org.hibernate.SQL]": DEBUG
    "[org.hibernate.orm.jdbc.bind]": TRACE

########################################
# JWT
########################################
jwt:
  secret: dGhpc2lzYXZlcnlsb25nc2VjcmV0a2V5Zm9yamF2YXdlYnRva2Vuc2lnbmluZ3B1cnBvc2Vz
  access-token-expire-time: 900000     # 15분 (밀리초) - RULE: Access Token ≤ 15분
  refresh-token-expire-time: 604800000 # 7일 (밀리초)

########################################
# Auth (Refresh Token Cookie, Rate Limit, Brute-force)
########################################
auth:
  refresh-token:
    cookie-name: cinema_refresh
    secure-cookie: false               # dev: false, prod: true (HTTPS만)
    max-age-seconds: 604800            # 7일
  rate-limit:
    login-per-minute: 10
    signup-per-minute: 5
    refresh-per-minute: 20
  brute-force:
    max-failed-attempts: 5
    lock-minutes: 15

########################################
# CORS
########################################
cors:
  allowed-origins: "*"                 # 개발 환경: 모든 origin 허용 (운영 시 특정 도메인으로 변경)
  max-age: 3600                        # Preflight 요청 캐시 시간 (초)

########################################
# API Rate Limit (Step 17)
########################################
reservation:
  rate-limit:
    per-minute: 60          # 예매 API(hold/release/pay/cancel) 분당 요청 수
admin:
  rate-limit:
    per-minute: 120         # 관리자 API 분당 요청 수

########################################
# Seat HOLD
########################################
seat:
  hold:
    ttl-minutes: 7                     # HOLD TTL (5~10분 권장)
    max-seats-per-user: 4              # 사용자당 최대 선택 가능 좌석 수
  # Step 5: 좌석 배치 조회 Redis 캐시
  status:
    cache-ttl-minutes: 5               # seat:status:{screeningId} 캐시 TTL (분)

########################################
# 가격 (Step 7, 가격 정책 미구현 시 좌석 타입별 기본가)
########################################
price:
  default:
    normal: 10000
    premium: 15000
    vip: 20000
    couple: 25000
    wheelchair: 10000

########################################
# Redisson (분산 락)
########################################
redisson:
  single-server-config:
    address: redis://localhost:6379
    connection-minimum-idle-size: 5
    connection-pool-size: 10
    idle-connection-timeout: 10000
    connect-timeout: 5000
    timeout: 3000
    retry-attempts: 3
    retry-interval: 1500
