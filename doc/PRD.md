# 영화관 예매 시스템 PRD (Product Requirements Document)

## 1. 프로젝트 개요

본 프로젝트는 멀티플렉스 영화관의 실시간 좌석 예매 시스템을 구축하는 것을 목표로 합니다. 회원 필수 서비스로, 실시간 및 사전 예매를 지원하며 좌석 지정 방식은 수동 선택 방식을 채택합니다.

## 2. 프로젝트 목표

### 2.1 서비스 성격
- [x] 서비스 성격 : 멀티플렉스, 회원 필수, 실시간 예매 & 사전 예매, 좌석 지정 방식 수동

### 2.2 성능 목표
- [x] 동시 접속자 수, 좌석 클릭 TPS : 최대 1000까지 제어
- [x] 피크타임 : 주말, 공휴일, 인기 영화 개봉일
- [x] 좌석 클릭 → 반영 < 200ms

### 2.3 사용자 웹 목표
- [x] 영화 목록 / 상영 시간표
- [x] 좌석 맵 실시간 반영
- [x] 좌석 HOLD 타이머 표시
- [x] 결제 페이지 UX 안정성
- [x] 좌석 맵 Canvas / SVG 렌더링
- [x] 새로고침 없이 좌석 갱신

### 2.4 관리자 웹 목표
- [x] 영화 / 상영 스케줄 관리
- [x] 가격 정책 관리
- [x] 좌석 배치 설정
- [x] 예매 / 결제 / 취소 조회

### 2.5 서버 목표
- [x] 좌석 HOLD / 해제
- [x] 예매 트랜잭션 보장
- [x] 장애 복구 가능 구조

### 2.6 아키텍처 목표
- [x] Domain-Driven Design
- [x] Stateless API
- [x] Redis + DB 혼합
- [x] 분산 락
- [x] 비동기 이벤트 처리

### 2.7 동시성 목표
- [x] 중복 예매 0%
- [x] HOLD 충돌 방지
- [x] 타임아웃 자동 해제

### 2.8 보안 목표
- [x] 예매 API Rate Limit
- [x] 결제 위변조 방지
- [x] HOLD Token 검증
- [x] 관리자 접근 제어
- [x] JWT + Refresh Token
- [x] API Rate Limit
- [x] Redis 기반 세션 보호

### 2.9 결제
- [x] 결제 : Mock

## 3. 구현 전 반드시 답해야 할 질문

### 3.1 최대 동시 예매 수는?
- **답변**: 최대 1000 TPS까지 지원하며, 분산 락과 Redis를 활용하여 동시성 제어

### 3.2 HOLD 시간은?
- **답변**: 좌석 선택 후 결제 진행까지의 시간 (일반적으로 5~10분 권장, 설정 가능)

### 3.3 장애 시 좌석은 어떻게?
- **답변**: 
  - Redis 장애 시: DB를 fallback으로 사용하여 좌석 상태 조회
  - HOLD 타임아웃 자동 해제로 좌석 복구
  - 트랜잭션 롤백을 통한 일관성 보장

### 3.4 결제 실패는 정상 플로우인가?
- **답변**: 
  - 결제 요청 시 좌석 상태는 PAYMENT_PENDING으로 전이
  - 결제 실패 시 PAYMENT_PENDING 상태의 좌석은 자동으로 AVAILABLE로 복구
  - HOLD 타임아웃 또는 결제 실패 시 좌석은 자동으로 해제
  - 사용자에게 재시도 옵션 제공
  - 결제 실패 이벤트를 로깅하여 분석 가능

## 4. 기술 스택

### 4.1 Web
- React + TypeScript

### 4.2 Mobile
- Flutter

### 4.3 Backend
- Spring Boot

### 4.4 Cache
- Redis

### 4.5 Database
- **개발 환경 (dev)**: H2 인메모리 데이터베이스
  - 별도 설치 불필요
  - 서버 재시작 시 데이터 초기화
  - 개발 및 테스트에 최적화
- **운영 환경 (prod)**: MySQL 8.0
  - 영구 데이터 저장소
  - 운영 환경에 최적화

### 4.6 Infrastructure
- Docker + Nginx

### 4.7 CI/CD
- GitHub Actions

## 5. 핵심 라이브러리

### 5.1 서버 (Spring Boot)
- Spring Web
- Spring Data JPA
- Spring Transaction
- Spring Security
- Spring Data Redis
- (기타 필요 시 동적 추가)

### 5.2 클라이언트 (Flutter)
- flutter_riverpod: 상태 관리
- logger: 디버깅 로그
- intl: 다국어 및 날짜 포맷팅
- (기타 필요 시 동적 추가)

### 5.3 클라이언트 (Web - Npm)
- Vite
- React
- TypeScript

## 6. 주요 기능 요구사항

### 6.1 사용자 기능
1. **회원 관리**
   - 회원 가입 / 로그인 (JWT + Refresh Token)
   - 회원 정보 관리

2. **영화 조회**
   - 영화 목록 조회
   - 영화 상세 정보
   - 상영 시간표 조회

3. **좌석 예매**
   - 실시간 좌석 맵 표시 (Canvas/SVG)
   - 좌석 선택 및 HOLD
   - HOLD 타이머 표시
   - 좌석 상태 실시간 갱신 (새로고침 없이)
   - 좌석 클릭 반응 속도 < 200ms

4. **결제**
   - Mock 결제 시스템
   - 결제 페이지 UX 안정성
   - 결제 실패 처리
   - 결제 진행 중 상태 관리 (PAYMENT_PENDING)

### 6.2 관리자 기능
1. **영화 관리**
   - 영화 등록 / 수정 / 삭제
   - 상영 스케줄 관리

2. **가격 정책 관리**
   - 시간대별 가격 설정
   - 좌석 등급별 가격 설정

3. **좌석 배치 설정**
   - 상영관별 좌석 배치 설정
   - 좌석 타입 설정

4. **예매 관리**
   - 예매 내역 조회
   - 결제 내역 조회
   - 취소 내역 조회
   - 좌석 상태 관리 (BLOCKED, DISABLED 설정)

## 7. 비기능 요구사항

### 7.1 성능
- 최대 동시 접속자: 1000명
- 좌석 클릭 TPS: 최대 1000
- 좌석 클릭 반응 시간: < 200ms
- 피크타임 대응: 주말, 공휴일, 인기 영화 개봉일

### 7.2 보안
- JWT + Refresh Token 인증
- API Rate Limit 적용
- Redis 기반 세션 보호
- HOLD Token 검증
- 관리자 접근 제어
- 결제 위변조 방지

### 7.3 가용성
- 장애 복구 가능 구조
- Redis 장애 시 DB Fallback
- 트랜잭션 보장

### 7.4 동시성
- 중복 예매 0% 보장
- HOLD 충돌 방지
- 분산 락 활용
- 타임아웃 자동 해제

## 8. 아키텍처 원칙

1. **Domain-Driven Design**: 도메인 중심 설계
2. **Stateless API**: 상태 비저장 API 설계
3. **Redis + DB 혼합**: 캐시와 영구 저장소 분리
4. **분산 락**: Redis 기반 분산 락으로 동시성 제어
5. **비동기 이벤트 처리**: 이벤트 기반 비동기 처리

## 9. 개발 일정 및 마일스톤

(추후 상세 일정 수립)

## 10. 참고사항

- 본 PRD는 프로젝트 진행 중 필요에 따라 업데이트될 수 있습니다.
- 기술 스택 및 라이브러리는 프로젝트 진행 중 필요에 따라 추가될 수 있습니다.
